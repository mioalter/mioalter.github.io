<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Altered States</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">ALTERED STATES</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>The Algebra of Two's Complement</h1>
            <article>
    <section class="header">
        Posted on January  2, 2021
        
    </section>
    <section>
        
<p>Suppose we want to work with positive and negative integers, but only have room to store <span class="math inline">2<sup><em>N</em></sup></span> distinct numbers where <span class="math inline"><em>N</em></span> is a positive even integer, think 32 or 64? Suppose further that we want to do this on a computer? Let’s first figure out how to do this at all, then figure out how to do it on a computer.</p>
<h1 id="the-integers-mod-2n">The integers mod <span class="math inline">2<sup><em>N</em></sup></span></h1>
<p>We want to work with integers—the whole numbers on the number line, positive, negative, and zero—meaning we want to have numbers and be able to add and multiply them, but we can only have <span class="math inline">2<sup><em>N</em></sup></span> distinct numbers.</p>
<p>We can take “the integers mod <span class="math inline">2<sup><em>N</em></sup></span>”, but let’s be precise about what that is. Informally, we take all of the integers, ask each one its remainder when we divide it by <span class="math inline">2<sup><em>N</em></sup></span>, group together the integers with the same remainder onto a team, and define addition and multiplication on the set of resulting teams. This is the “how do you make teams in gym class” description.</p>
<p>More formally: we define an <a href="https://mioalter.github.io/posts/2019-09-04-Equivalence-Relations.html">equivalence relation</a> by saying that two integers are equivalent if their difference is a multiple of <span class="math inline">2<sup><em>N</em></sup></span> (this is equivalent to “have the same remainder when divided by <span class="math inline">2<sup><em>N</em></sup></span>”) and take the set of <em>equivalence classes</em>. Let’s write <span class="math inline">[2]</span> for “the equivalence class of <span class="math inline">2</span>”, meaning, the set of all integers equivalent to <span class="math inline">2</span>, namely <span class="math inline">{…,  − 2<sup><em>N</em></sup> + 2, 2, 2<sup><em>N</em></sup> + 2, …}</span>. This means, of course, that <span class="math inline">[2]</span> is the same as <span class="math inline">[2<sup><em>N</em></sup> + 2]</span>, is the same as <span class="math inline">[ − 2<sup><em>N</em></sup> + 2]</span>, etc. so there are infinitely many ways to represent each of these. We call <span class="math inline">2</span> a <em>representative</em> of the equivalence class <span class="math inline">[2]</span>, each class has infinitely many representatives.</p>
<p>One way to think of this is: we mark off all the multiples of <span class="math inline">2<sup><em>N</em></sup></span> on the number line, then roll up the whole number line so these points all align to get a circle of circumference <span class="math inline">2<sup><em>N</em></sup></span>. We will only care about the integer points on the number line / circle, but there is no harm in picturing the points in between. So we have a circle. We can define addition, multiplication, and negatives on here, but we need to figure out how. Our intuition about how these work on the usual flat number line may fail us so we’ll need to build up new intution.</p>
<p>Remember that our numbers on the circle are our gym class teams, our equivalence classes, the sets <span class="math inline">[0]</span>, <span class="math inline">[1]</span>, …, <span class="math inline">[2<sup><em>N</em></sup> − 1]</span>.</p>
<p>First, addition: let’s define <span class="math inline">[<em>a</em>] + [<em>b</em>]</span> to be <span class="math inline">[<em>a</em> + <em>b</em>]</span>. So, for example, <span class="math inline">[1] + [2] = [1 + 2] = [3]</span>. Does this make sense? We have to check that we get the same answer no matter which representative we choose. Try it, it works.</p>
<p>Next, multiplication: let’s define <span class="math inline">[<em>a</em>] * [<em>b</em>]</span> to be <span class="math inline">[<em>a</em> * <em>b</em>]</span>. So, for example, <span class="math inline">[2] * [3] = [2 * 3] = [6]</span>. Same story, this has to be independent of which representatives we choose. It is.</p>
<p>There is plenty more: we have a zero for addition, <span class="math inline">[0]</span>, we have a one for multiplication, <span class="math inline">[1]</span>, we have inverses for addition, multiplication distributes over addition, and then there are a few weird things. Let’s make a list</p>
<ul>
<li>we have addition: <span class="math inline">[<em>a</em>] + [<em>b</em>] = [<em>a</em> + <em>b</em>]</span></li>
<li>addition is associative and commutative</li>
<li>we have a zero (additive identity): <span class="math inline">[0] + [<em>a</em>] = [<em>a</em>]</span></li>
<li>we have additive inverses: <span class="math inline">[<em>a</em>] + [ − <em>a</em>] = [<em>a</em> + ( − <em>a</em>)] = [<em>a</em> − <em>a</em>] = [0]</span></li>
<li>we have multiplication: <span class="math inline">[<em>a</em>] * [<em>b</em>] = [<em>a</em> * <em>b</em>]</span></li>
<li>multiplication is associative and commutative</li>
<li>we have a one (multiplicative identity): <span class="math inline">[1] * [<em>a</em>] = [1 * <em>a</em>] = [<em>a</em>]</span></li>
<li>mulplication distributes over addition: <span class="math inline">[<em>a</em>] * ([<em>b</em>] + [<em>c</em>]) = [<em>a</em>] * [<em>b</em> + <em>c</em>] = [<em>a</em> * (<em>b</em> + <em>c</em>)] = [<em>a</em> * <em>b</em> + <em>a</em> * <em>c</em>] = [<em>a</em> * <em>b</em>] + [<em>a</em> * <em>c</em>]</span></li>
</ul>
<p>and some weirdness</p>
<ul>
<li><p>since <span class="math inline">[ − <em>a</em>] = [2<sup><em>N</em></sup> − <em>a</em>]</span>, we can add together two positive-looking numbers and get zero: e.g. <span class="math inline">[3] + [2<sup><em>N</em></sup> − 3] = [0]</span></p></li>
<li><p>we can multiply together nonzero numbers and get zero: e.g. <span class="math inline">[2] * [2<sup><em>N</em> − 1</sup>] = [2 * 2<sup><em>N</em> − 1</sup>] = [2<sup><em>N</em></sup>] = [0]</span></p></li>
</ul>
<p>These just come with the territory: we are on a circle, addition and multiplication move us around the circle, and sometimes we end up back at the point <span class="math inline">[0]</span>.</p>
<p>The integers are denoted by <span class="math inline">ℤ</span> in math and the number system we just defined is usually written <span class="math inline">ℤ/2<sup><em>N</em></sup>ℤ</span> and called “Z mod 2 to the N” or “Z mod 2 to the N Z”. It has both addition and multiplication so it is a ring. We’ll define a few other rings and homomorphisms bewteen them, that is, functions which preserve their additive and multiplicative structure.</p>
<p>So that’s how to work with integers when we can only have <span class="math inline">2<sup><em>N</em></sup></span> distinct numbers.</p>
<h1 id="example-with-n-3">Example with <span class="math inline"><em>N</em> = 3</span></h1>
<p>Let’s consider <span class="math inline"><em>N</em> = 3</span> so <span class="math inline">2<sup><em>N</em></sup> = 8</span> and picture our circle sitting in the x-y plane like so.</p>
<p><img src="../images/circle-mod-8.jpg" /></p>
<p>Let’s do some computations</p>
<ul>
<li><span class="math inline">[5] + [6] = [11] = [3]</span></li>
<li><span class="math inline">[5] + [8] = [13] = [5]</span></li>
<li><span class="math inline">[5] * [3] = [15] = [16 − 1] = [ − 1]</span></li>
</ul>
<p>Adding additive inverses to our picture</p>
<p><img src="../images/circle-mod-8-negs.jpg" /></p>
<p>we see that the negative of each element is its reflection over the x-axis. This means that the two numbers on the x-axis, <span class="math inline">[0]</span> and <span class="math inline">[4]</span> are their own additive inverses.</p>
<h1 id="the-ring-u_n">The ring <span class="math inline"><em>U</em><sub><em>N</em></sub></span></h1>
<p>Now, let’s consider the set <span class="math inline"><em>U</em><sub><em>N</em></sub> = {0, 1, …, 2<sup><em>N</em></sup> − 1}</span>. We’ll make this into a ring in a way that is probably expected to some and unexpected to others.</p>
<p>We have one obvious function “iota”</p>
<p><span class="math inline"><em>ι</em> : <em>U</em><sub><em>N</em></sub> → ℤ</span></p>
<p>which is just inclusion of an integer between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span> into the set of all integers. We have another less-obvious function “tau”</p>
<p><span class="math inline"><em>τ</em> : ℤ → <em>U</em><sub><em>N</em></sub></span></p>
<p>given by truncation which is defined as follows. Given an integer <span class="math inline"><em>a</em></span>, write its binary expansion and throw away the terms in the sum corresponding to powers of <span class="math inline">2</span> that are greater than or equal to <span class="math inline"><em>N</em></span>. Explicitly, for</p>
<p><span class="math inline"><em>a</em> = <em>a</em><sub><em>N</em> + <em>K</em> − 1</sub> * 2<sup><em>N</em> + <em>K</em> − 1</sup> + ⋯ + <em>a</em><sub><em>N</em></sub> * 2<sup><em>N</em></sup> + <em>a</em><sub><em>N</em> − 1</sub> * 2<sup><em>N</em> − 1</sup> + ⋯ + <em>a</em><sub>1</sub> * 2 + <em>a</em><sub>0</sub></span></p>
<p>we have</p>
<p><span class="math inline"><em>τ</em>(<em>a</em>) = <em>a</em><sub><em>N</em> − 1</sub> * 2<sup><em>N</em> − 1</sup> + ⋯ + <em>a</em><sub>1</sub> * 2 + <em>a</em><sub>0</sub></span>.</p>
<p>Our set <span class="math inline"><em>U</em><sub><em>N</em></sub></span> consists exactly of the integers with at most <span class="math inline"><em>N</em></span> digits in their binary representations and our truncation function just truncates them to their <span class="math inline"><em>N</em></span> smallest digits.</p>
<p>Now, let’s define addition and multiplication in <span class="math inline"><em>U</em><sub><em>N</em></sub></span> by</p>
<ul>
<li><span class="math inline"><em>a</em> + <em>b</em> = <em>τ</em>(<em>ι</em>(<em>a</em>) + <em>ι</em>(<em>b</em>))</span></li>
<li><span class="math inline"><em>a</em> * <em>b</em> = <em>τ</em>(<em>ι</em>(<em>a</em>) * <em>ι</em>(<em>b</em>))</span></li>
</ul>
<p>In words: we include our integers <span class="math inline"><em>a</em></span> and <span class="math inline"><em>b</em></span>, both of which are between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span>, into the set of all integers, add or multiply up there, then truncate.</p>
<p>It is a little exercise to check that these are both associative by writing out the binary expansions of the integers that <span class="math inline"><em>τ</em></span> is eating. A helpful trick is to observe that if <span class="math inline"><em>x</em></span> and <span class="math inline"><em>y</em></span> are both integers, not necessarily between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span>, then <span class="math inline"><em>τ</em>(<em>ι</em>(<em>τ</em>(<em>x</em>)) + <em>y</em>) = <em>τ</em>(<em>x</em> + <em>y</em>)</span> since the extra terms in the binary expansion of <span class="math inline"><em>x</em></span> get discarded anyway.</p>
<p>Don’t let the <span class="math inline"><em>ι</em></span> throw you, it is just there to be extra explicit about when we mean an arbitrary integer and when we mean one in a specific range. It is almost the identity function.</p>
<p>These are also both commutative, <span class="math inline">0</span> is the zero for addition, <span class="math inline">1</span> is the one for multiplication. What about additive inverses? Well,</p>
<p><span class="math inline"><em>a</em> + (2<sup><em>N</em></sup> − <em>a</em>) = <em>τ</em>(<em>ι</em>(<em>a</em>) + <em>ι</em>(2<sup><em>N</em></sup> − <em>a</em>)) = <em>τ</em>(2<sup><em>N</em></sup>) = 0</span>.</p>
<p>So that is that: <span class="math inline"><em>U</em><sub><em>N</em></sub></span> is a ring. Is <span class="math inline"><em>τ</em></span> a ring homomorphism? It is, again using the same observation about <span class="math inline"><em>τ</em></span>. Skipping some steps,</p>
<p><span class="math inline"><em>τ</em>(<em>a</em> + <em>b</em>) = <em>τ</em>((<em>a</em><sub><em>N</em> + <em>K</em> − 1</sub> + <em>b</em><sub><em>N</em> + <em>K</em> − 1</sub>) * 2<sup><em>N</em> + <em>K</em> − 1</sup> + ⋯ + <em>a</em><sub>0</sub> + <em>b</em><sub>0</sub>)</span></p>
<p>by writing out the binary expansions of <span class="math inline"><em>a</em></span> and <span class="math inline"><em>b</em></span>, and</p>
<p><span class="math inline"><em>τ</em>(<em>a</em>) + <em>τ</em>(<em>b</em>) = <em>τ</em>(<em>ι</em>(<em>τ</em>(<em>a</em>)) + <em>ι</em>(<em>τ</em>(<em>b</em>)))</span></p>
<p>which, writing out the expansions of <span class="math inline"><em>τ</em>(<em>a</em>)</span> and <span class="math inline"><em>τ</em>(<em>b</em>)</span>, is</p>
<p><span class="math inline"><em>τ</em>((<em>a</em><sub><em>N</em> − 1</sub> + <em>b</em><sub><em>N</em> − 1</sub>) * 2<sup><em>N</em> − 1</sup> + ⋯ + <em>a</em><sub>0</sub> + <em>b</em><sub>0</sub>)</span></p>
<p>and the extra terms in the first get discarded by <span class="math inline"><em>τ</em></span>.</p>
<h1 id="an-isomorphism-mathbb-z2nmathbb-zto-u_n">An isomorphism <span class="math inline">ℤ/2<sup><em>N</em></sup>ℤ → <em>U</em><sub><em>N</em></sub></span></h1>
<p>Let’s start with an observation: given an integer <span class="math inline"><em>a</em></span>, we can write out the binary expansion of <span class="math inline"><em>a</em></span></p>
<p><span class="math inline"><em>a</em> = <em>a</em><sub><em>N</em> + <em>K</em> − 1</sub> * 2<sup><em>N</em> + <em>K</em> − 1</sup> + ⋯ + <em>a</em><sub><em>N</em></sub> * 2<sup><em>N</em></sup> + ⋯ + <em>a</em><sub>1</sub> * 2 + <em>a</em><sub>0</sub></span></p>
<p>and then factor a <span class="math inline">2<sup><em>N</em></sup></span> out of each of the first <span class="math inline"><em>K</em></span> terms of this sum</p>
<p><span class="math inline"><em>a</em> = 2<sup><em>N</em></sup> * (<em>a</em><sub><em>N</em> + <em>K</em></sub> * 2<sup><em>K</em> − 1</sup> + ⋯ + <em>a</em><sub><em>N</em></sub>) + <em>a</em><sub><em>N</em> − 1</sub> * 2<sup><em>N</em> − 1</sup> + ⋯ + <em>a</em><sub>1</sub> * 2 + <em>a</em><sub>0</sub></span></p>
<p>Recognizing the <span class="math inline"><em>a</em><sub><em>N</em> − 1</sub> * 2<sup><em>N</em> − 1</sup> + ⋯ + <em>a</em><sub>0</sub></span> summand is <span class="math inline"><em>τ</em>(<em>a</em>)</span> we can write</p>
<p><span class="math inline"><em>a</em> = 2<sup><em>N</em></sup> * stuff + <em>τ</em>(<em>a</em>)</span></p>
<p>which says that <span class="math inline">[<em>a</em>] = [<em>τ</em>(<em>a</em>)]</span>. Moreover, since <span class="math inline"><em>τ</em>(<em>a</em>)</span> is between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span>, this says that <span class="math inline"><em>τ</em>(<em>a</em>)</span> is the unique representative of <span class="math inline">[<em>a</em>]</span> between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span>.</p>
<p>Now, let’s define a function <span class="math inline"><em>f</em> : ℤ/2<sup><em>N</em></sup>ℤ → <em>U</em><sub><em>N</em></sub></span> by</p>
<p><span class="math inline"><em>f</em>([<em>a</em>]) = <em>τ</em>(<em>a</em>)</span>.</p>
<p>Is this well-defined? What if we choose a different representative of <span class="math inline">[<em>a</em>]</span>? Well, if we choose another representative <span class="math inline"><em>b</em></span>, so <span class="math inline">[<em>b</em>] = [<em>a</em>]</span>, then, as we just, saw <span class="math inline">[<em>τ</em>(<em>b</em>)] = [<em>τ</em>(<em>a</em>)]</span>. Also, <span class="math inline"><em>τ</em>(<em>b</em>)</span> is the unique representative of <span class="math inline">[<em>τ</em>(<em>b</em>)]</span> between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span>. But so is <span class="math inline"><em>τ</em>(<em>a</em>)</span>. So they are equal. More directly: if <span class="math inline">[<em>b</em>] = [<em>a</em>]</span>, then the difference between <span class="math inline"><em>b</em></span> and <span class="math inline"><em>a</em></span> is a multiple of <span class="math inline">2<sup><em>N</em></sup></span> so we can write <span class="math inline"><em>b</em> = <em>a</em> + <em>k</em> * 2<sup><em>N</em></sup></span> for some integer <span class="math inline"><em>k</em></span>, and from the definition of <span class="math inline"><em>τ</em></span>, we can see that <span class="math inline"><em>τ</em>(<em>a</em> + <em>k</em> * 2<sup><em>N</em></sup>) = <em>τ</em>(<em>a</em>)</span>.</p>
<p>Is <span class="math inline"><em>f</em></span> a homomorphism? On the one hand,</p>
<p><span class="math inline"><em>f</em>([<em>a</em>] + [<em>b</em>]) = <em>f</em>([<em>a</em> + <em>b</em>]) = <em>τ</em>(<em>a</em> + <em>b</em>)</span></p>
<p>on the other,</p>
<p><span class="math inline"><em>f</em>([<em>a</em>]) + <em>f</em>([<em>b</em>]) = <em>τ</em>(<em>a</em>) + <em>τ</em>(<em>b</em>)</span></p>
<p>and the equality of these two things is the statement that <span class="math inline"><em>τ</em></span> is a homorphism for addition which we already waved our hands at. Similarly for multiplication. So yes, <span class="math inline"><em>f</em></span> is a ring homomorphism.</p>
<p>Finally: is <span class="math inline"><em>f</em></span> an isomorphsim? It has to be onto and 1-1. It is both. The “onto” is pretty straight forward: if <span class="math inline"><em>a</em></span> is in <span class="math inline"><em>U</em><sub><em>N</em></sub></span>, then <span class="math inline"><em>a</em> = <em>τ</em>(<em>ι</em>(<em>a</em>))</span> which is equal to <span class="math inline"><em>f</em>([<em>ι</em>(<em>a</em>)])</span> so <span class="math inline"><em>a</em></span> is <span class="math inline"><em>f</em></span> of something thus <span class="math inline"><em>f</em></span> is onto. For the 1-1: if <span class="math inline"><em>τ</em>(<em>a</em>) = <em>τ</em>(<em>b</em>)</span>, then <span class="math inline">[<em>τ</em>(<em>a</em>)] = [<em>τ</em>(<em>b</em>)]</span>, but <span class="math inline">[<em>τ</em>(<em>a</em>)] = [<em>a</em>]</span> and <span class="math inline">[<em>τ</em>(<em>b</em>)] = [<em>b</em>]</span> so <span class="math inline">[<em>a</em>] = [<em>b</em>]</span>. So yes, <span class="math inline"><em>f</em></span> is 1-1.</p>
<p>Thus, <span class="math inline"><em>f</em></span> is an isomorphism of rings. So arithmetic in <span class="math inline"><em>U</em><sub><em>N</em></sub></span> <em>is</em> arithmetic in <span class="math inline">ℤ/2<sup><em>N</em></sup>ℤ</span>, we just replaced the equivalence classes <span class="math inline">[0], [1], …, [2<sup><em>N</em></sup> − 1]</span> with the numbers <span class="math inline">0, 1, …, 2<sup><em>N</em></sup> − 1</span>, their unique representatives between <span class="math inline">0</span> and <span class="math inline">2<sup><em>N</em></sup> − 1</span>.</p>
<h1 id="the-ring-t_n">The ring <span class="math inline"><em>T</em><sub><em>N</em></sub></span></h1>
<p>Now, let’s take another set, the set <span class="math inline"><em>T</em><sub><em>N</em></sub> = { − 2<sup><em>N</em> − 1</sup>,  − 2<sup><em>N</em> − 1</sup> + 1, …,  − 1, 0, 1, …, 2<sup><em>N</em> − 1</sup> − 1}</span> This set also has <span class="math inline">2<sup><em>N</em></sup></span> elements. Let’s not even waste time defining a new ring structure on here and instead just define a bijection with a ring we already have and transport the ring structure over via that bijection. Sounds like a mouthful, but it is pretty straight forward. Let’s define a function <span class="math inline"><em>g</em> : ℤ/2<sup><em>N</em></sup>ℤ → <em>T</em><sub><em>N</em></sub></span> by saying that <span class="math inline"><em>f</em>([<em>a</em>])</span> is the unique representative of <span class="math inline">[<em>a</em>]</span> between <span class="math inline"> − 2<sup><em>N</em> − 1</sup></span> and <span class="math inline">2<sup><em>N</em> − 1</sup> − 1</span>. This is clearly a bijection. Write <span class="math inline"><em>g</em><sup> − 1</sup></span> for its inverse function <span class="math inline"><em>g</em><sup> − 1</sup> : <em>T</em><sub><em>N</em></sub> → ℤ/2<sup><em>N</em></sup>ℤ</span>. Now we can transport the ring structure on <span class="math inline">ℤ/2<sup><em>N</em></sup>ℤ</span> to <span class="math inline"><em>T</em><sub><em>N</em></sub></span> via <span class="math inline"><em>g</em></span> by defining, for <span class="math inline"><em>a</em>, <em>b</em></span> in <span class="math inline"><em>T</em><sub><em>N</em></sub></span>,</p>
<p><span class="math inline"><em>a</em> + <em>b</em> = <em>g</em>(<em>g</em><sup> − 1</sup>(<em>a</em>) + <em>g</em><sup> − 1</sup>(<em>b</em>))</span></p>
<p>and similarly for multiplication. That is,</p>
<p><span class="math inline"><em>a</em> + <em>b</em> = <em>g</em>([<em>a</em>] + [<em>b</em>]) = <em>g</em>([<em>a</em> + <em>b</em>])</span></p>
<p>and</p>
<p><span class="math inline"><em>a</em> * <em>b</em> = <em>g</em>([<em>a</em>] * [<em>b</em>]) = <em>g</em>([<em>a</em> * <em>b</em>])</span></p>
<p>So, just as in <span class="math inline"><em>U</em><sub><em>N</em></sub></span>, arithmetic <em>is</em> arithmetic in <span class="math inline">ℤ/2<sup><em>N</em></sup>ℤ</span>, we just replaced the classes</p>
<p><span class="math inline">[0], [1], …, [2<sup><em>N</em> − 1</sup> − 1], [2<sup><em>N</em> − 1</sup>], …, [2<sup><em>N</em></sup> − 1]</span></p>
<p>with the numbers</p>
<p><span class="math inline">0, 1, …, 2<sup><em>N</em> − 1</sup> − 1,  − 2<sup><em>N</em> − 1</sup>,  − 2<sup><em>N</em> − 1</sup> + 1, …,  − 1</span>.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
